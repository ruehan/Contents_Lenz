<!DOCTYPE html>
<html lang="ko">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Contents Lenz - AI 기반 콘텐츠 요약 및 분석 도구</title>
		<style>
			body {
				font-family: "Arial", sans-serif;
				line-height: 1.6;
				color: #333;
				max-width: 1200px;
				margin: 0 auto;
				padding: 20px;
				background-color: #f5f5f5;
			}
			header {
				text-align: center;
				margin-bottom: 30px;
			}
			h1 {
				color: #2c3e50;
			}
			.container {
				display: flex;
				gap: 20px;
			}
			.input-section,
			.output-section {
				flex: 1;
				background: white;
				border-radius: 8px;
				padding: 20px;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
			}
			.tab-buttons {
				display: flex;
				margin-bottom: 15px;
			}
			.tab-button {
				flex: 1;
				padding: 10px;
				background: #e0e0e0;
				border: none;
				cursor: pointer;
				font-weight: bold;
			}
			.tab-button.active {
				background: #3498db;
				color: white;
			}
			.tab-content {
				display: none;
			}
			.tab-content.active {
				display: block;
			}
			textarea {
				width: 100%;
				height: 300px;
				padding: 10px;
				border: 1px solid #ddd;
				border-radius: 4px;
				resize: vertical;
				font-family: inherit;
			}
			.options {
				margin: 20px 0;
				display: flex;
				gap: 15px;
				flex-wrap: wrap;
			}
			.option-group {
				flex: 1;
				min-width: 200px;
			}
			label {
				display: block;
				margin-bottom: 5px;
				font-weight: bold;
			}
			select {
				width: 100%;
				padding: 8px;
				border: 1px solid #ddd;
				border-radius: 4px;
			}
			button {
				background: #2ecc71;
				color: white;
				border: none;
				padding: 10px 15px;
				border-radius: 4px;
				cursor: pointer;
				font-weight: bold;
				transition: background 0.3s;
			}
			button:hover {
				background: #27ae60;
			}
			button:disabled {
				background: #95a5a6;
				cursor: not-allowed;
			}
			.file-input {
				margin-bottom: 15px;
			}
			.file-input input {
				display: block;
				margin-top: 5px;
			}
			.progress {
				display: none;
				margin: 20px 0;
				height: 20px;
				background: #ecf0f1;
				border-radius: 10px;
				overflow: hidden;
			}
			.progress-bar {
				height: 100%;
				background: #3498db;
				width: 0%;
				transition: width 0.3s;
			}
			.error {
				color: #e74c3c;
				margin: 10px 0;
				font-weight: bold;
			}
			.success {
				color: #2ecc71;
				margin: 10px 0;
				font-weight: bold;
			}
			.info {
				color: #3498db;
				margin: 10px 0;
				font-style: italic;
			}
			#output {
				white-space: pre-wrap;
				padding: 15px;
				border: 1px solid #ddd;
				border-radius: 4px;
				background: #f9f9f9;
				min-height: 300px;
				max-height: 500px;
				overflow-y: auto;
			}
			.download-options {
				margin-top: 20px;
			}
			footer {
				text-align: center;
				margin-top: 30px;
				color: #7f8c8d;
				font-size: 0.9em;
			}
		</style>
	</head>
	<body>
		<header>
			<h1>Contents Lenz</h1>
			<p>GPT-4o Mini 모델을 활용한 AI 기반 콘텐츠 요약 및 분석 도구</p>
		</header>

		<div class="container">
			<div class="input-section">
				<h2>입력</h2>

				<div class="tab-buttons">
					<button class="tab-button active" data-tab="text-tab">텍스트 입력</button>
					<button class="tab-button" data-tab="file-tab">파일 업로드</button>
				</div>

				<div class="tab-content active" id="text-tab">
					<textarea id="input-text" placeholder="여기에 요약할 텍스트를 입력하세요..."></textarea>
					<div id="detected-language" class="info"></div>
				</div>

				<div class="tab-content" id="file-tab">
					<div class="file-input">
						<label for="input-file">파일 선택 (TXT, PDF, DOCX)</label>
						<input type="file" id="input-file" accept=".txt,.pdf,.docx,.doc,.md,.html" />
					</div>
					<div id="file-preview"></div>
				</div>

				<div class="options">
					<div class="option-group">
						<label for="length-select">요약 길이</label>
						<select id="length-select">
							{% for key, value in summary_lengths.items() %}
							<option value="{{ key }}">{{ value }}</option>
							{% endfor %}
						</select>
					</div>

					<div class="option-group">
						<label for="format-select">요약 형식</label>
						<select id="format-select">
							{% for key, value in summary_formats.items() %}
							<option value="{{ key }}">{{ value }}</option>
							{% endfor %}
						</select>
					</div>

					<div class="option-group">
						<label for="language-select">출력 언어</label>
						<select id="language-select">
							{% for key, value in supported_languages.items() %}
							<option value="{{ key }}">{{ value }}</option>
							{% endfor %}
						</select>
					</div>
				</div>

				<button id="detect-language-btn">언어 감지</button>
				<button id="summarize-btn">요약하기</button>

				<div class="progress">
					<div class="progress-bar"></div>
				</div>

				<div id="error-message" class="error"></div>
			</div>

			<div class="output-section">
				<h2>요약 결과</h2>
				<div id="output">요약 결과가 여기에 표시됩니다...</div>

				<div class="download-options">
					<button id="download-txt-btn" disabled>TXT로 다운로드</button>
					<button id="download-docx-btn" disabled>DOCX로 다운로드</button>
					<button id="copy-btn" disabled>클립보드에 복사</button>
				</div>
			</div>
		</div>

		<footer>
			<p>© 2023 Contents Lenz Team. All rights reserved.</p>
		</footer>

		<script>
			document.addEventListener("DOMContentLoaded", function () {
				// 탭 전환 기능
				const tabButtons = document.querySelectorAll(".tab-button");
				const tabContents = document.querySelectorAll(".tab-content");

				tabButtons.forEach((button) => {
					button.addEventListener("click", () => {
						const tabId = button.getAttribute("data-tab");

						tabButtons.forEach((btn) => btn.classList.remove("active"));
						tabContents.forEach((content) => content.classList.remove("active"));

						button.classList.add("active");
						document.getElementById(tabId).classList.add("active");
					});
				});

				// 요약 기능
				const summarizeBtn = document.getElementById("summarize-btn");
				const detectLanguageBtn = document.getElementById("detect-language-btn");
				const inputText = document.getElementById("input-text");
				const inputFile = document.getElementById("input-file");
				const lengthSelect = document.getElementById("length-select");
				const formatSelect = document.getElementById("format-select");
				const languageSelect = document.getElementById("language-select");
				const output = document.getElementById("output");
				const errorMessage = document.getElementById("error-message");
				const detectedLanguage = document.getElementById("detected-language");
				const progress = document.querySelector(".progress");
				const progressBar = document.querySelector(".progress-bar");

				const downloadTxtBtn = document.getElementById("download-txt-btn");
				const downloadDocxBtn = document.getElementById("download-docx-btn");
				const copyBtn = document.getElementById("copy-btn");

				// 파일 업로드 처리
				inputFile.addEventListener("change", function (e) {
					const file = e.target.files[0];
					if (file) {
						const filePreview = document.getElementById("file-preview");
						filePreview.textContent = `선택된 파일: ${file.name} (${formatFileSize(file.size)})`;
					}
				});

				// 언어 감지 버튼 클릭 이벤트
				detectLanguageBtn.addEventListener("click", async function () {
					const text = inputText.value.trim();
					if (!text) {
						errorMessage.textContent = "언어를 감지할 텍스트를 입력하세요.";
						return;
					}

					// UI 상태 업데이트
					detectLanguageBtn.disabled = true;
					errorMessage.textContent = "";
					detectedLanguage.textContent = "언어 감지 중...";

					try {
						// 언어 감지 API 호출
						const formData = new FormData();
						formData.append("text", text);

						const response = await fetch("/detect-language", {
							method: "POST",
							body: formData,
						});

						const data = await response.json();

						if (response.ok) {
							detectedLanguage.textContent = `감지된 언어: ${data.language_name} (${data.language})`;

							// 언어 선택 드롭다운 업데이트
							if (data.language && languageSelect.value === "auto") {
								// 자동 모드인 경우 감지된 언어로 설정
								for (let i = 0; i < languageSelect.options.length; i++) {
									if (languageSelect.options[i].value === data.language) {
										languageSelect.selectedIndex = i;
										break;
									}
								}
							}
						} else {
							errorMessage.textContent = data.error || "언어 감지 중 오류가 발생했습니다.";
							detectedLanguage.textContent = "";
						}
					} catch (error) {
						errorMessage.textContent = "서버 연결 오류가 발생했습니다.";
						detectedLanguage.textContent = "";
					} finally {
						detectLanguageBtn.disabled = false;
					}
				});

				// 요약 버튼 클릭 이벤트
				summarizeBtn.addEventListener("click", async function () {
					// 현재 활성화된 탭 확인
					const activeTab = document.querySelector(".tab-content.active").id;
					let formData = new FormData();

					// 요약 옵션 추가
					formData.append("length", lengthSelect.value);
					formData.append("format", formatSelect.value);
					formData.append("language", languageSelect.value);

					if (activeTab === "text-tab") {
						const text = inputText.value.trim();
						if (!text) {
							errorMessage.textContent = "요약할 텍스트를 입력하세요.";
							return;
						}

						formData.append("input_type", "text");
						formData.append("text", text);
					} else {
						const file = inputFile.files[0];
						if (!file) {
							errorMessage.textContent = "파일을 선택하세요.";
							return;
						}

						formData.append("input_type", "file");
						formData.append("file", file);
					}

					// UI 상태 업데이트
					summarizeBtn.disabled = true;
					detectLanguageBtn.disabled = true;
					errorMessage.textContent = "";
					output.textContent = "요약 중...";
					progress.style.display = "block";

					// 진행 상태 애니메이션
					let width = 0;
					const progressInterval = setInterval(() => {
						if (width >= 90) {
							clearInterval(progressInterval);
						} else {
							width += 1;
							progressBar.style.width = width + "%";
						}
					}, 100);

					try {
						// 요약 API 호출
						const response = await fetch("/summarize", {
							method: "POST",
							body: formData,
						});

						const data = await response.json();

						if (response.ok) {
							output.textContent = data.summary;

							// 감지된 언어 표시 (자동 모드인 경우)
							if (data.detected_language && languageSelect.value === "auto") {
								detectedLanguage.textContent = `감지된 언어: ${data.detected_language_name} (${data.detected_language})`;
							}

							// 다운로드 버튼 활성화
							downloadTxtBtn.disabled = false;
							downloadDocxBtn.disabled = false;
							copyBtn.disabled = false;
						} else {
							errorMessage.textContent = data.error || "요약 중 오류가 발생했습니다.";
							output.textContent = "요약 결과가 여기에 표시됩니다...";
						}
					} catch (error) {
						errorMessage.textContent = "서버 연결 오류가 발생했습니다.";
						output.textContent = "요약 결과가 여기에 표시됩니다...";
					} finally {
						// 진행 상태 완료
						clearInterval(progressInterval);
						progressBar.style.width = "100%";

						// 1초 후 진행 상태 숨기기
						setTimeout(() => {
							progress.style.display = "none";
							progressBar.style.width = "0%";
							summarizeBtn.disabled = false;
							detectLanguageBtn.disabled = false;
						}, 1000);
					}
				});

				// 다운로드 버튼 이벤트
				downloadTxtBtn.addEventListener("click", () => downloadSummary(".txt"));
				downloadDocxBtn.addEventListener("click", () => downloadSummary(".docx"));

				// 클립보드 복사 버튼 이벤트
				copyBtn.addEventListener("click", function () {
					const summaryText = output.textContent;
					navigator.clipboard.writeText(summaryText).then(() => {
						const originalText = copyBtn.textContent;
						copyBtn.textContent = "복사됨!";
						setTimeout(() => {
							copyBtn.textContent = originalText;
						}, 2000);
					});
				});

				// 요약 결과 다운로드 함수
				async function downloadSummary(format) {
					const summary = output.textContent;
					if (!summary || summary === "요약 결과가 여기에 표시됩니다...") {
						errorMessage.textContent = "다운로드할 요약 결과가 없습니다.";
						return;
					}

					const formData = new FormData();
					formData.append("summary", summary);
					formData.append("format", format);

					try {
						const response = await fetch("/download", {
							method: "POST",
							body: formData,
						});

						if (response.ok) {
							// 파일 다운로드 처리
							const blob = await response.blob();
							const url = window.URL.createObjectURL(blob);
							const a = document.createElement("a");
							a.style.display = "none";
							a.href = url;
							a.download = `summary${format}`;
							document.body.appendChild(a);
							a.click();
							window.URL.revokeObjectURL(url);
						} else {
							const data = await response.json();
							errorMessage.textContent = data.error || "다운로드 중 오류가 발생했습니다.";
						}
					} catch (error) {
						errorMessage.textContent = "서버 연결 오류가 발생했습니다.";
					}
				}

				// 파일 크기 포맷 함수
				function formatFileSize(bytes) {
					if (bytes === 0) return "0 Bytes";
					const k = 1024;
					const sizes = ["Bytes", "KB", "MB", "GB"];
					const i = Math.floor(Math.log(bytes) / Math.log(k));
					return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
				}
			});
		</script>
	</body>
</html>
